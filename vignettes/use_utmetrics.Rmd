---
title: "Use utMetrics"
output: 
  prettydoc::html_pretty:
    theme: architect
    highlight: vignette
    #toc: yes

vignette: >
  %\VignetteIndexEntry{use_utmetrics}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, echo=FALSE}
library(utMetrics)
library(tidyverse)
library(DT)
```

```{r echo=FALSE, out.width = "55%", fig.align = "center"}
knitr::include_graphics("use_metrics.jpg")
```

utMetrics provides the official metrics of Utah Tech University. These metrics can be used in both internal and external presentations regarding Utah Tech University. If you need metrics that you can't find here, please reach out to the Institutional Effectiveness office (datablaze@utahtech.edu) to receive those metrics.

## utMetrics Library
```{r}
library(utMetrics)
```

## utMetrics Functionality

### Data Frames
utMetrics provides a data frame with all the metrics and their values. The dataframe is df_metric_indices

```{r}
df_metrics_indices <- utMetrics::df_metrics_indices

datatable(df_metrics_indices)
```
As shown above, you can bring in a data frame and name it. Datatable is a way to show the results.

#### df_metrics_indices
df_metrics_indices contains 12 variables (columns)

- metric_index - a code indicating the computation (3 characters, i.e. hcc) and a number indicating the partition (4 characters) with an underscore between (i.e. hcc_0001)
- metric - the combination of season, computation, "By", partition, ":", and segment (i.e. Fall Census Headcount By All Students:all students)
- computation - the way a metric is computed or calculated (i.e. Census Headcount)
- partition - the way to parse or break down a metric. In the literature, this is often referred to as disaggregating data (i.e. Gender). More than one partition can be used in a metric.
- segment - the value that each partition produces. The values are typically unique to the partition (i.e. Female).
- year - is the calendar year of the metric
- season - Fall, Spring, Summer
- metric_type - the type of calculation the metric is (count, rate, sum)
- metric_number - the metric displayed as a number (i.e. 56.2, 12200)
- metric_number_char - the metric number but displayed as a character, with the percent sign or a comma (i.e. 56.2%, 12,200)
- metric_segment_index - a code indicating the computation (3 characters, i.e. hcc), a number indicating the partition (4 characters), and si followed by a number indicating the segment (5 characters) with an underscore between (i.e. hcc_0001_si00838)
- metric_segment_season_index - same as the metric_segment_index, but followed by an underscore and the season code (20 Spring, 30 Summer, 40 Fall, i.e. hcc_0001_si00838_20)

### Use or display utMetrics data

Data from utMetrics can be used in a report.

#### Example Fall Census Headcount by Student Type
This shows all the possible student type segments for all 5 years
```{r}
fall_census_student_type_hc_1 <- utMetrics::df_metrics_indices %>% 
    filter(computation == 'Census Headcount' &
           partition == 'Student Type' &
           season == 'Fall')
```

You can pull the same data this way. This is less code, but less descriptive.
```{r}
fall_census_student_type_hc_2 <- utMetrics::df_metrics_indices %>% 
    filter(metric_index == 'hcc_0003' &
           season == 'Fall')
```

#### Example Fall Census Headcount by Student Type : Freshman
This shows data for student type where the segment is Freshman for all 5 years
```{r}
fall_census_student_type_fresh_hc_1 <- utMetrics::df_metrics_indices %>% 
    filter(computation == 'Census Headcount' &
           partition == 'Student Type' &
           segment == 'Freshman' &
           season == 'Fall')
```

You can pull the same data this way. This is less code.
```{r}
fall_census_student_type_fresh_hc_2 <- utMetrics::df_metrics_indices %>% 
    filter(metric == 'Fall Census Headcount By Student Type:Freshman')
```

You can pull the same data this way. This is similar amount of code, but less descriptive.
```{r}
fall_census_student_type_fresh_hc_3 <- utMetrics::df_metrics_indices %>% 
    filter(metric_segment_season_index == 'hcc_0003_si00497_40')
```
	
## Organize Data for a Report

```{r}
fall_census_student_type_hc_display <- utMetrics::df_metrics_indices %>%
  filter(metric == 'Fall Census Headcount By Student Type:Freshman') %>% 
  select(year, segment, metric_number_char) %>%
  rename(Count = metric_number_char,
         "Student Type" = segment,
         Year = year) %>%
  arrange(Year, "Student Type") %>%
  unique()

datatable(fall_census_student_type_hc_display)
```


the data frames available
when to use which data frame
define the fields in each data frame
how to search the data frames and other vignettes to look at for more information
give examples of code to use to pull metrics
give examples of narrowing down the results to a specific year
give examples of narrowing down the result to a specific segment (show the metric_segment_index and the metric_segement_season_index)
give examples of using the metric and the metric index
give examples using the metric_number and the metric_number_char and describe when you would use each
give examples of the outputs
note how to request new metrics or new partitions (examples)
Here is some starting code:
headcount <- utMetrics::df_metrics_indices %>%
filter(computation == 'Census Headcount'
& partition == 'Student Type'
& season == 'Fall') %>%
select(year, segment, metric_number_char) %>%
rename(Count = metric_number_char,
"Student Type" = segment,
Year = year) %>%
arrange(Year, "Student Type") %>%
unique()
